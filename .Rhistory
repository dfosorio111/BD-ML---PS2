#Limpiar el ambiente
rm(list=ls())
#Diego
setwd("C:/Users/Diego/OneDrive/Documents/GitHub/BD-ML---PS2")
#Se establece semilla
set.seed(1000)
#Importar paquetes y cargar librerías
require(pacman)
p_load(tidyverse, rvest, data.table, dplyr, skimr, caret, rio,
vtable, stargazer, ggplot2, boot, MLmetrics, lfe,
tidyverse, fabricatr, stargazer, Hmisc, writexl, viridis, here)
#Importar archivos Daniel
train_hogares <- readRDS("train_hogares.Rds")
#Importar archivos Diego
train_hogares <- readRDS("C:/Users/Diego/OneDrive/Documents/GitHub/BD-ML---PS2/data/train_hogares.Rds")
test_hogares <- readRDS("C:/Users/Diego/OneDrive/Documents/GitHub/BD-ML---PS2/data/test_hogares.Rds")
train_personas <- readRDS("C:/Users/Diego/OneDrive/Documents/GitHub/BD-ML---PS2/data/train_personas.Rds")
test_personas <- readRDS("C:/Users/Diego/OneDrive/Documents/GitHub/BD-ML---PS2/data/test_personas.Rds")
#Que variables se comparten?
names(test_hogares)
names(train_hogares)
#Que variables se comparten?
names(test_personas)
names(train_personas)
#Construir pobrezaMonetaria porque "pobre" hace referencia a pobreza extrema
train_hogares <- train_hogares%>%mutate(prueba_pobreza = ifelse(Ingpcug < Li, 1, 0))
train_hogares <- train_hogares%>%mutate(test1 = ifelse(Pobre == prueba_pobreza, TRUE, FALSE))
train_hogares%>%count(test1)
train_hogares <- train_hogares%>%mutate(prueba_pobreza2 = ifelse(Ingpcug < Lp, 1, 0))
train_hogares <- train_hogares%>%mutate(tets = ifelse(Pobre == prueba_pobreza2, TRUE, FALSE))
train_hogares%>%count(tets)
#Base para clasificación hogares
train_h <- train_hogares[names(test_hogares)]
train_h$Pobre <- train_hogares$Pobre
train_p <- train_personas[names(test_personas)]
#Creación de variables de nivel hogar en base personas
#Número de mujeres por hogar
train_p <- train_p%>%mutate(mujer = P6020 - 1)
train_p_num_muj <- train_p%>%group_by(id)%>%summarise(num_mujeres = sum(mujer))
#Jefe de hogar es mujer?
train_p <- train_p%>%mutate(jefe_y_mujer = ifelse(mujer == 1 & P6050 == 1, 1, 0))
train_p_jef_muj <- train_p%>%group_by(id)%>%summarise(jefe_mujer = sum(jefe_y_mujer))
#Edad jefe del hogar
train_p_edadjefe <- train_p%>%subset(P6050==1)%>%select(id, P6040)
#Jefe del hogar cotiza a seguridad social
train_p_jefecotiza <- train_p%>%subset(P6050==1)%>%select(id, P6090)%>%mutate(jefe_cotiza=ifelse(is.na(P6090),9,P6090))
#Maximo nivel educactivo en el hogar
train_p_adulto_maxlev_edu <-train_p%>%subset(is.na(P6210)==FALSE)%>%group_by(id)%>%summarise(max_edu_lev_h = max(P6210))
train_p_adulto_maxlev_edu <-train_p%>%subset(is.na(P6210)==FALSE)%>%group_by(id)%>%summarise(max_edu_lev_h = max(P6210))
#
train_p_jefeofi <- train_p%>%subset(P6050==1)%>%select(id, Oficio)
View(train_p_jefeofi)
View(train_p_jefeofi)
train_p$
train_p_jefeofi%>%count()
train_p_jefeofi%>%count(Oficio)
is.na(train_p_jefeofi)%>%table()
is.na(train_p_jefeofi$Oficio)%>%table()
train_p$ocu
train_p$oc
train_p$oc
train_p$oc
train_p$oc
train_p$Oc
train_p%>%subset(P6050==1 & (Des==1 | Ina==1))%>%select(id, Des, Ina, P, P6430)
train_p%>%subset(P6050==1 & (Des==1 | Ina==1))%>%select(id, Des, Ina, 6430)
train_p%>%subset(P6050==1 & (Des==1 | Ina==1))%>%select(id, Des, Ina, P6430)
View(train_p%>%subset(P6050==1 & (Des==1 | Ina==1))%>%select(id, Des, Ina, P6430))
is.na(train_p%>%subset(P6050==1 & (Des==1 | Ina==1))%>%select(P6430))%>%table()
train_p%>%count(P6430)
train_p_jef_ocu <- train_p%>%subset(P6050==1)%>%mutate(relab_jefe= ifelse(Oc==1,P6430, ifelse(Des==1,10,11)) )
train_p_jef_ocu <- train_p%>%subset(P6050==1)%>%mutate(relab_jefe= ifelse(Oc==1,P6430, ifelse(Des==1,10,11)) )
View(train_p_jef_ocu)
View(train_p_jef_ocu)
is.na(train_p_jef_ocu$relab_jefe)
is.na(train_p_jef_ocu$relab_jefe)%>%count()
is.na(train_p_jef_ocu$relab_jefe)%>%table()
train_p_jef_ocu <- train_p%>%subset(P6050==1)%>%mutate(relab_jefe= ifelse(Oc==1,P6430, 10) )  #ifelse(Des==1,10,11)
train_p_jef_ocu <- train_p%>%subset(P6050==1)%>%mutate(relab_jefe= ifelse(Oc==1,P6430, 10) )  #ifelse(Des==1,10,11)
train_p_jef_ocu <- train_p%>%subset(P6050==1)%>%mutate(relab_jefe= ifelse(Oc==1,P6430, 10) )  #ifelse(Des==1,10,11)
is.na(train_p_jef_ocu$relab_jefe)%>%table()
train_p_jef_ocu <- train_p%>%subset(P6050==1)%>%mutate(relab_jefe= ifelse(Oc==1,P6430, 10) )  #ifelse(Des==1,10,11)
is.na(train_p_jef_ocu$relab_jefe)%>%table()
train_p_jef_ocu <- train_p%>%subset(P6050==1)%>%mutate(relab_jefe= ifelse(is.na(Oc), 10, P6430) )  #ifelse(Des==1,10,11)
is.na(train_p_jef_ocu$relab_jefe)%>%table()
train_p_jef_ocu <- train_p%>%subset(P6050==1)%>%mutate(relab_jefe= ifelse(is.na(Oc), ifelse(is.na(Des), 11, 10) , P6430) )  #ifelse(Des==1,10,11)
is.na(train_p_jef_ocu$relab_jefe)%>%table()
train_p_jef_ocu%>%select(Oc, Des, Ina, P6430, relab_jefe)
View(train_p_jef_ocu%>%select(Oc, Des, Ina, P6430, relab_jefe))
#Que variables se comparten?
names(test_personas)
names(train_personas)
is.na(train_p)%>%count()
is.na(train_p$P6580)%>%table()
#Que variables se comparten?
names(test_personas)
names(train_personas)
is.na(train_p_jefecotiza$jefe_cotiza)%>%table()
train_p%>%select(id, P6585s3)
train_p%>%select(id, P6585s3)%>%table()
view(train_p%>%select(id, P6585s3)%>%table())
train_p%>%select(id, P6585s3)%>%table()
train_p%>%select(id, P6585s3)
View(train_p%>%select(id, P6585s3))
#Que variables se comparten?
names(test_personas)
names(train_personas)
View(train_p%>%select(id, P6585s4))
